# for run
# uvicorn fastapiTest:app --reload
# uvicorn fastapiTest:app --port 3000
# https://requests.readthedocs.io/en/latest/

from fastapi import FastAPI, Response, Request
from fastapi.responses import HTMLResponse
from fastapi.responses import RedirectResponse
from fastapi.templating import Jinja2Templates
import requests
import test

app = FastAPI()

items = [1, 2, 3]


templates = Jinja2Templates(directory="html")

@app.get("/data")
async def root():
    return items


@app.get("/html-custom", response_class=HTMLResponse)
async def read_items():
    return """
    <html>
        <head>
            <title>Python TestServer Page</title>
        </head>
        <body>
            <h1>Python TestServer Page</h1>
        </body>
    </html>
    """

# response_status = 307 Temporary redirect
@app.get("/redirect", response_class=RedirectResponse)
async def redirect_fastapi():
    return "http://localhost:3000/html"

@app.get('/html')
def htmlTemplate(request: Request):
    # test.foo('123')
    return templates.TemplateResponse("index.html", {"request": request})


@app.get('/api')
def api_data(request: Request):
    # test.foo('123')
    response = requests.get('http://localhost:3000/data')
    print('Status', response.status_code)
    print('Data', response.json())
    data = response.json()
    return data

